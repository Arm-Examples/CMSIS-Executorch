#  SPDX-FileCopyrightText: Copyright 2022-2025 Arm Limited and/or its
#  affiliates <open-source-office@arm.com>
#  SPDX-License-Identifier: Apache-2.0
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.

# A project translates into one executable or library.
project:
  # List the packs used in the project.
  packs:
    - pack: ARM::CMSIS
    - pack: ARM::CMSIS-RTX@^5.9.0

  # List of miscellaneous tool-specific controls
  misc:
    - CPP:
        - -Wno-deprecated-declarations
    - Link:
        - -Wl,-u,_printf_float
        - -Wl,--whole-archive
        - $SolutionDir()$/ai_layer/engine/lib/libexecutorch_delegate_ethos_u.a
        - $SolutionDir()$/ai_layer/engine/lib/libquantized_ops_lib.a
        - -idirafter $SolutionDir()$/ai_layer/engine/include/executorch/runtime/platform
        - -Wl,--no-whole-archive

  # List of #define statements passed via the command line to the build tool.
  define:
    # Name for the Idle and Timer thread
    - OS_IDLE_THREAD_NAME: \"Idle\"
    - OS_TIMER_THREAD_NAME: \"Timer\"
    # Memory allocator settings (very conservative to fit in DTCM)
    - ET_ARM_BAREMETAL_SCRATCH_TEMP_ALLOCATOR_POOL_SIZE: 0x20000  # 128KB
    - ET_ARM_BAREMETAL_METHOD_ALLOCATOR_POOL_SIZE: 0x8000         # 32KB
    # Core ExecuTorch defines
    - C10_USING_CUSTOM_GENERATED_MACROS
    # Runtime configuration
    - ET_NUM_INFERENCES: 1
    # Debug logging configuration
    - ET_LOG_DUMP_OUTPUT
    - ET_DEBUG_BUFFER_SIZE: 0x8000                                # 32KB (minimal)

  # List of source groups and files added to a project or a layer.
  groups:
    - group: Example Arm ExecuTorch runner
      add-path:
        - src/executor_runner/
      files:
        - file: src/executor_runner/arm_executor_runner.cpp
        - file: src/executor_runner/arm_memory_allocator.cpp
        - file: src/executor_runner/arm_perf_monitor.cpp
        - file: src/app_main.c

  # List components to use for your application.
  # A software component is a re-usable unit that may be configurable.
  components:
    - component: CMSIS:OS Tick:SysTick
    - component: CMSIS:RTOS2:Keil RTX5&Source

  # List layers to be included in the project.
  layers:
    - layer: $Board-Layer$
      type: Board

    - layer: $SolutionDir()$/ai_layer/ai_layer.clayer.yml

  # List executable file formats to be generated.
  output:
    type:
      - elf
      - hex
      - map
